{% extends 'layouts/base.html' %}
{% block title %}Scan Book{% endblock %}
{% block content %}
<div class="text-center">
  <h2 class="mb-4">ðŸ“· Escanea la portada del libro</h2>
  <div class="relative inline-block">
    <!-- Webcam Feed -->
    <video id="video" autoplay playsinline class="rounded shadow" width="640" height="480"></video>

    <!-- Overlay Grid -->
    <div class="absolute top-0 left-0 w-full h-full flex items-center justify-center pointer-events-none">
      <div class="border-4 border-black opacity-40 w-64 h-64"></div>
    </div>
  </div>

  <button id="captureBtn" class="btn btn-primary mt-4">Capturar</button>
  <canvas id="canvas" class="mt-4 d-none"></canvas>
</div>

<script>
  const video = document.getElementById('video');
  const canvas = document.getElementById('canvas');
  const captureBtn = document.getElementById('captureBtn');

  // Access webcam
  navigator.mediaDevices.getUserMedia({ video: true })
    .then(stream => {
      video.srcObject = stream;
    })
    .catch(err => {
      console.error("Error accessing webcam:", err);
    });

  // Capture frame
  captureBtn.addEventListener('click', () => {
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    canvas.getContext('2d').drawImage(video, 0, 0, canvas.width, canvas.height);
    canvas.classList.remove('d-none');

    // You can now send canvas.toDataURL() to your backend or AI model
  });
</script>
{% endblock %}